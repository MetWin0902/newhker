# 新港人生活号微信小程序应用系统

## 项目概述

新港人生活号是一个面向想进入香港的外来人群（如大陆高级知识分子/企业家）的信息服务平台。主要解答他们对香港政策和生活的疑惑，涵盖最新香港人才政策、金融、教育和生活等方面的内容。

## 技术栈

### 后端
- **框架**: Spring Boot 3.2.0
- **JDK**: 21
- **数据库**: MySQL 8.0+
- **缓存**: Redis
- **ORM**: MyBatis Plus 3.5.5
- **连接池**: Druid
- **认证**: JWT
- **文件存储**: MinIO
- **工具库**: Hutool

### 前端（管理后台）
- **框架**: Vue 3
- **构建工具**: Vite 4
- **UI框架**: Element Plus
- **状态管理**: Pinia
- **路由**: Vue Router 4
- **HTTP客户端**: Axios
- **富文本编辑器**: WangEditor

## 项目结构

```
new_hker/
├── newhker/                    # 后端项目（多模块Maven项目）
│   ├── pom.xml                # 父级POM文件
│   │
│   ├── nhk-common/            # 通用模块
│   │   ├── pom.xml
│   │   └── src/main/java/com/newhker/
│   │       ├── common/        # 通用响应类（Result, PageResult）
│   │       ├── exception/     # 异常处理类
│   │       ├── config/        # 通用配置（Redis, MyBatisPlus, Web, MinIO）
│   │       └── utils/         # 工具类（JWT, MinIO）
│   │
│   ├── nhk-model/             # 数据模型模块
│   │   ├── pom.xml
│   │   └── src/main/java/com/newhker/
│   │       ├── entity/        # 实体类（9个实体）
│   │       ├── dto/           # 数据传输对象（7个DTO）
│   │       └── vo/            # 视图对象（3个VO）
│   │
│   ├── nhk-service/           # 服务层模块
│   │   ├── pom.xml
│   │   └── src/main/java/com/newhker/
│   │       ├── mapper/        # Mapper接口（9个Mapper）
│   │       └── service/       # 服务类（9个Service）
│   │
│   ├── nhk-api/               # API接口模块
│   │   ├── pom.xml
│   │   └── src/main/java/com/newhker/controller/
│   │       ├── admin/         # 管理后台接口（6个Controller）
│   │       └── mini/          # 小程序端接口（7个Controller）
│   │
│   └── nhk-start/             # 启动模块
│       ├── pom.xml
│       └── src/main/
│           ├── java/com/newhker/
│           │   └── NewHkerApplication.java  # 启动类
│           └── resources/
│               ├── application.yml          # 配置文件
│               └── sql/init.sql             # SQL脚本
│
└── newhker-fe/                 # 前端项目（管理后台）
    ├── src/
    │   ├── api/                # API接口
    │   ├── assets/             # 静态资源
    │   ├── components/         # 组件
    │   ├── layout/             # 布局
    │   ├── router/             # 路由
    │   ├── stores/             # 状态管理
    │   ├── utils/              # 工具类
    │   ├── views/              # 页面
    │   ├── App.vue
    │   └── main.js
    ├── index.html
    ├── package.json
    └── vite.config.js
```

## 模块说明

### 后端模块划分

#### 1. nhk-common（通用模块）
**职责**：提供通用的工具类、配置和异常处理

**包含内容**：
- `common/`: 统一响应类（Result）、分页结果类（PageResult）
- `exception/`: 业务异常类、全局异常处理器
- `config/`: Redis配置、MyBatisPlus配置、Web配置、MinIO配置
- `utils/`: JWT工具类、MinIO文件上传工具类

**依赖**：Spring Boot基础包、Redis、JWT、Hutool、MinIO

#### 2. nhk-model（数据模型模块）
**职责**：定义所有数据模型

**包含内容**：
- `entity/`: 9个实体类（User、Admin、Module、Article、Banner、UserCollect、UserLike、UserBrowse、Feedback）
- `dto/`: 7个数据传输对象（登录、文章、模块、Banner等）
- `vo/`: 3个视图对象（文章详情、文章列表、模块树）

**依赖**：nhk-common、MyBatis Plus

#### 3. nhk-service（服务层模块）
**职责**：实现业务逻辑和数据访问

**包含内容**：
- `mapper/`: 9个Mapper接口
- `service/`: 9个Service业务类（用户、管理员、文章、Banner、模块、收藏、点赞、浏览、反馈）

**依赖**：nhk-model、MySQL Driver、Druid

#### 4. nhk-api（API接口模块）
**职责**：对外提供REST API接口

**包含内容**：
- `controller/admin/`: 6个管理后台Controller（认证、用户、文章、模块、Banner、上传）
- `controller/mini/`: 7个小程序端Controller（Banner、模块、文章、收藏、点赞、反馈、上传）

**依赖**：nhk-service

#### 5. nhk-start（启动模块）
**职责**：应用启动和运行配置

**包含内容**：
- 启动类（NewHkerApplication）
- 配置文件（application.yml）
- 数据库初始化脚本（init.sql）

**依赖**：nhk-api（依赖传递，包含所有模块）

## 功能模块

### 1. 微信小程序端（RPC接口）

#### 1.1 首页
- 最热政策Banner展示
- 模块分类（身份、教育、金融、生活）
  - L1: 一级分类
  - L2: 二级分类
  - L3: 三级分类
- 相关文章列表

#### 1.2 工具
- 紧急求助
- 汇率查询
- 假期查询

#### 1.3 个人中心
- 我的收藏
- 我的点赞
- 浏览记录（保留7天）
- 意见反馈

### 2. 管理后台

#### 2.1 用户管理
- 用户列表查询
- 用户拉黑/解除拉黑

#### 2.2 文章管理
- 文章列表（支持筛选）
- 文章新增/编辑
- 文章审核（通过/拒绝）
- 文章发布/下架
- 支持图文和视频类型
- 富文本编辑器
- 文章预览

#### 2.3 模块管理
- 模块树形展示
- 模块新增/编辑/删除
- 三级模块支持

#### 2.4 Banner管理
- Banner列表
- Banner新增/编辑
- Banner审核
- Banner发布/下架
- 支持跳转到文章详情或外链

## API接口说明

### 微信小程序端接口

所有接口前缀: `/api/mini`

| 接口路径 | 方法 | 说明 |
|---------|------|------|
| /banner/list | GET | 获取Banner列表 |
| /module/tree | GET | 获取模块树形结构 |
| /article/page | GET | 分页获取文章列表 |
| /article/{id} | GET | 获取文章详情 |
| /collect/add | POST | 收藏文章 |
| /collect/cancel | POST | 取消收藏 |
| /like/add | POST | 点赞文章 |
| /like/cancel | POST | 取消点赞 |
| /feedback/submit | POST | 提交反馈 |
| /upload | POST | 文件上传 |

### 管理后台接口

所有接口前缀: `/api/admin`

| 接口路径 | 方法 | 说明 |
|---------|------|------|
| /auth/login | POST | 管理员登录 |
| /user/page | GET | 分页查询用户 |
| /user/block/{id} | POST | 拉黑用户 |
| /user/unblock/{id} | POST | 解除拉黑 |
| /article/page | GET | 分页查询文章 |
| /article/{id} | GET | 获取文章详情 |
| /article | POST | 保存文章 |
| /article/audit | POST | 审核文章 |
| /article/publish/{id} | POST | 发布文章 |
| /article/offline/{id} | POST | 下架文章 |
| /article/{id} | DELETE | 删除文章 |
| /module/tree | GET | 获取模块树 |
| /module/list | GET | 获取模块列表 |
| /module | POST | 保存模块 |
| /module/{id} | DELETE | 删除模块 |
| /banner/page | GET | 分页查询Banner |
| /banner | POST | 保存Banner |
| /banner/audit | POST | 审核Banner |
| /banner/publish/{id} | POST | 发布Banner |
| /banner/offline/{id} | POST | 下架Banner |
| /banner/{id} | DELETE | 删除Banner |
| /upload | POST | 文件上传 |

## 部署说明

### 环境要求

- JDK 21
- MySQL 8.0+
- Redis 6.0+
- MinIO (可选，用于文件存储)
- Node.js 16+

### 后端部署

1. **配置数据库**
```bash
# 创建数据库并执行SQL脚本
mysql -u root -p < newhker/nhk-start/src/main/resources/sql/init.sql
```

2. **修改配置文件**
```yaml
# newhker/nhk-start/src/main/resources/application.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/newhker
    username: your_username
    password: your_password
  data:
    redis:
      host: localhost
      port: 6379
      password: your_redis_password

minio:
  endpoint: http://localhost:9000
  access-key: your_access_key
  secret-key: your_secret_key
```

3. **编译并启动**
```bash
cd newhker

# 方式1：使用Maven编译打包
mvn clean package
java -jar nhk-start/target/nhk-start-1.0.0.jar

# 方式2：使用Maven直接运行
cd nhk-start
mvn spring-boot:run
```

### 前端部署

1. **安装依赖**
```bash
cd newhker-fe
npm install
```

2. **开发环境运行**
```bash
npm run dev
```

3. **生产环境构建**
```bash
npm run build
```

## 默认账号

管理后台默认账号:
- 用户名: `admin`
- 密码: `admin123`

## 数据库设计

### 核心数据表

1. **tb_user** - 用户表
2. **tb_admin** - 管理员表
3. **tb_module** - 模块分类表
4. **tb_article** - 文章表
5. **tb_banner** - Banner表
6. **tb_user_collect** - 用户收藏表
7. **tb_user_like** - 用户点赞表
8. **tb_user_browse** - 用户浏览记录表
9. **tb_feedback** - 用户反馈表

详细表结构请查看: `newhker/nhk-start/src/main/resources/sql/init.sql`

## Maven模块依赖关系

```
nhk-start (启动模块)
    ↓ 依赖
nhk-api (API层)
    ↓ 依赖
nhk-service (服务层)
    ↓ 依赖
nhk-model (数据模型层)
    ↓ 依赖
nhk-common (通用层)
```

**依赖传递原则**：
- 每个模块只直接依赖下一层模块
- 通过Maven依赖传递，上层模块可以使用所有下层模块的类
- 保证模块之间的单向依赖，避免循环依赖

## 开发说明

### 后端开发规范

- 统一使用 `Result` 包装返回结果
- 使用 `@Valid` 进行参数校验
- 使用 `BusinessException` 抛出业务异常
- Service层编写业务逻辑
- Controller层只做参数校验和调用Service

### 前端开发规范

- 使用 Composition API
- 统一使用 `@/api` 调用后端接口
- 使用 Element Plus 组件库
- 路由使用懒加载

## 注意事项

1. 首次运行需要先创建数据库并执行SQL脚本
2. 需要先启动MySQL和Redis服务
3. 如使用MinIO，需要先启动MinIO服务
4. JWT密钥建议在生产环境修改
5. 管理员密码使用BCrypt加密存储

## 后续开发建议

1. 完善微信小程序端的登录授权
2. 实现汇率查询、假期查询等工具功能
3. 增加数据统计和分析功能
4. 优化文章搜索功能
5. 增加定时任务清理过期数据
6. 完善日志记录和监控

## 联系方式

如有问题，请联系开发团队。
