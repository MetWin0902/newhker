# 后端多模块Maven项目改造说明

## 改造概述

已将原单体Spring Boot项目重构为多模块Maven项目，采用经典的分层架构设计，提高代码的可维护性和可复用性。

## 模块结构

### 1. 父工程（newhker）
- **位置**: `/backend/pom.xml`
- **类型**: pom
- **职责**: 
  - 统一管理所有子模块
  - 定义公共依赖版本
  - 配置构建插件

### 2. nhk-common（通用模块）
- **位置**: `/backend/nhk-common/`
- **文件数**: 10个Java文件
- **包含内容**:
  ```
  ├── common/
  │   ├── Result.java           # 统一响应结果
  │   └── PageResult.java       # 分页结果
  ├── exception/
  │   ├── BusinessException.java           # 业务异常
  │   └── GlobalExceptionHandler.java      # 全局异常处理器
  ├── config/
  │   ├── MyBatisPlusConfig.java          # MyBatis Plus配置
  │   ├── RedisConfig.java                # Redis配置
  │   ├── WebConfig.java                  # Web配置（跨域等）
  │   └── MinioConfig.java                # MinIO配置
  └── utils/
      ├── JwtUtils.java                   # JWT工具类
      └── MinioUtils.java                 # MinIO文件上传工具
  ```
- **依赖**: Spring Boot基础包、Redis、JWT、Hutool、MinIO

### 3. nhk-model（数据模型模块）
- **位置**: `/backend/nhk-model/`
- **文件数**: 19个Java文件
- **包含内容**:
  ```
  ├── entity/          # 9个实体类
  │   ├── User.java
  │   ├── Admin.java
  │   ├── Module.java
  │   ├── Article.java
  │   ├── Banner.java
  │   ├── UserCollect.java
  │   ├── UserLike.java
  │   ├── UserBrowse.java
  │   └── Feedback.java
  ├── dto/             # 7个DTO
  │   ├── AdminLoginDTO.java
  │   ├── WxLoginDTO.java
  │   ├── ArticleDTO.java
  │   ├── ArticleQueryDTO.java
  │   ├── BannerDTO.java
  │   ├── ModuleDTO.java
  │   └── FeedbackDTO.java
  └── vo/              # 3个VO
      ├── ArticleDetailVO.java
      ├── ArticleListVO.java
      └── ModuleTreeVO.java
  ```
- **依赖**: nhk-common、MyBatis Plus

### 4. nhk-service（服务层模块）
- **位置**: `/backend/nhk-service/`
- **文件数**: 18个Java文件
- **包含内容**:
  ```
  ├── mapper/          # 9个Mapper接口
  │   ├── UserMapper.java
  │   ├── AdminMapper.java
  │   ├── ModuleMapper.java
  │   ├── ArticleMapper.java
  │   ├── BannerMapper.java
  │   ├── UserCollectMapper.java
  │   ├── UserLikeMapper.java
  │   ├── UserBrowseMapper.java
  │   └── FeedbackMapper.java
  └── service/         # 9个Service类
      ├── UserService.java
      ├── AdminService.java
      ├── ModuleService.java
      ├── ArticleService.java
      ├── BannerService.java
      ├── UserCollectService.java
      ├── UserLikeService.java
      ├── UserBrowseService.java
      └── FeedbackService.java
  ```
- **依赖**: nhk-model、MySQL Driver、Druid

### 5. nhk-api（API接口模块）
- **位置**: `/backend/nhk-api/`
- **文件数**: 13个Java文件
- **包含内容**:
  ```
  └── controller/
      ├── admin/       # 6个管理后台Controller
      │   ├── AdminAuthController.java
      │   ├── AdminUserController.java
      │   ├── AdminArticleController.java
      │   ├── AdminModuleController.java
      │   ├── AdminBannerController.java
      │   └── AdminUploadController.java
      └── mini/        # 7个小程序端Controller
          ├── MiniBannerController.java
          ├── MiniModuleController.java
          ├── MiniArticleController.java
          ├── MiniCollectController.java
          ├── MiniLikeController.java
          ├── MiniFeedbackController.java
          └── MiniUploadController.java
  ```
- **依赖**: nhk-service

### 6. nhk-start（启动模块）
- **位置**: `/backend/nhk-start/`
- **文件数**: 3个文件
- **包含内容**:
  ```
  ├── java/com/newhker/
  │   └── NewHkerApplication.java      # Spring Boot启动类
  └── resources/
      ├── application.yml              # 应用配置文件
      └── sql/
          └── init.sql                 # 数据库初始化脚本
  ```
- **依赖**: nhk-api（通过依赖传递包含所有模块）

## 模块依赖关系

```
nhk-start
    ↓ 依赖
nhk-api
    ↓ 依赖
nhk-service
    ↓ 依赖
nhk-model
    ↓ 依赖
nhk-common
```

**说明**:
- 单向依赖，避免循环依赖
- 上层模块可以使用下层模块的所有类
- 通过Maven依赖传递机制，nhk-start模块可以访问所有模块的类

## 编译和运行

### 编译整个项目
```bash
cd backend
mvn clean install
```

### 运行项目
```bash
# 方式1：运行打包后的jar
cd backend
mvn clean package
java -jar nhk-start/target/nhk-start-1.0.0.jar

# 方式2：使用Maven插件直接运行
cd backend/nhk-start
mvn spring-boot:run
```

### 只编译某个模块
```bash
cd backend/nhk-common
mvn clean install
```

## 改造优势

### 1. 职责清晰
每个模块职责单一，便于理解和维护

### 2. 代码复用
- `nhk-common`模块可以被其他项目复用
- 通用工具类、配置类统一管理

### 3. 独立开发
- 不同团队可以并行开发不同模块
- 模块之间通过接口隔离

### 4. 灵活部署
- 可以根据需要选择性打包模块
- 支持微服务改造（将来可以拆分为独立服务）

### 5. 依赖管理
- 父工程统一管理依赖版本
- 避免版本冲突
- 便于升级依赖

### 6. 构建优化
- 只重新编译修改的模块
- 提高构建效率

## 注意事项

### 1. 包扫描
确保启动类的 `@SpringBootApplication` 注解能扫描到所有模块的包：
```java
@SpringBootApplication
@MapperScan("com.newhker.mapper")  // 扫描Mapper接口
public class NewHkerApplication {
    // ...
}
```

### 2. 配置文件
所有配置文件统一放在 `nhk-start/src/main/resources/` 目录下

### 3. Mapper XML文件
如果需要使用MyBatis XML映射文件，应放在：
- `nhk-service/src/main/resources/mapper/` 目录
- 在 `application.yml` 中配置：`mybatis-plus.mapper-locations: classpath*:/mapper/**/*.xml`

### 4. 打包注意
- 只有 `nhk-start` 模块配置了 `spring-boot-maven-plugin`
- 其他模块只打成普通jar包
- 最终可执行jar在 `nhk-start/target/` 目录

## 统计信息

- **总模块数**: 6个（1个父工程 + 5个子模块）
- **Java文件总数**: 61个
- **POM文件数**: 6个
- **代码行数**: 约5000+行

## 下一步优化建议

1. 添加单元测试模块
2. 考虑将API模块拆分为admin-api和mini-api
3. 增加公共接口模块（定义服务接口，便于将来微服务改造）
4. 添加代码质量检查工具（如SonarQube）
5. 集成CI/CD流程
