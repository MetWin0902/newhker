# 多模块项目快速启动指南

## 前置条件

- JDK 21
- Maven 3.6+
- MySQL 8.0+
- Redis 6.0+
- Node.js 16+ (前端)

## 快速启动步骤

### 1. 启动基础服务

#### 启动MySQL
```bash
# 确保MySQL服务运行
mysql.server start  # macOS
# 或
systemctl start mysql  # Linux
```

#### 启动Redis
```bash
# 确保Redis服务运行
redis-server  # 直接启动
# 或
brew services start redis  # macOS使用Homebrew
# 或
systemctl start redis  # Linux
```

### 2. 初始化数据库

```bash
# 登录MySQL
mysql -u root -p

# 执行初始化脚本
source /Users/yhw/new_hker/backend/nhk-start/src/main/resources/sql/init.sql

# 或者直接执行
mysql -u root -p < /Users/yhw/new_hker/backend/nhk-start/src/main/resources/sql/init.sql
```

### 3. 修改配置

编辑 `backend/nhk-start/src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/newhker
    username: root
    password: your_password  # 修改为你的密码
  
  data:
    redis:
      host: localhost
      port: 6379
      password:  # 如果Redis设置了密码，填写在这里
```

### 4. 启动后端服务

#### 方式1：使用Maven运行（推荐开发环境）
```bash
cd /Users/yhw/new_hker/backend/nhk-start
mvn spring-boot:run
```

#### 方式2：打包后运行（推荐生产环境）
```bash
cd /Users/yhw/new_hker/backend

# 编译打包（跳过测试）
mvn clean package -DskipTests

# 运行
java -jar nhk-start/target/nhk-start-1.0.0.jar
```

#### 方式3：使用IDE运行
- 用IDEA或其他IDE打开 `backend` 目录
- 找到 `nhk-start` 模块的 `NewHkerApplication.java`
- 右键运行主方法

### 5. 验证后端启动

访问以下地址验证：
- 控制台输出：`新港人生活号后端系统启动成功！`
- 服务地址：http://localhost:8080/api

### 6. 启动前端服务

```bash
cd /Users/yhw/new_hker/frontend

# 首次运行需要安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 7. 访问系统

- **管理后台**: http://localhost:3000
- **默认账号**: 
  - 用户名：`admin`
  - 密码：`admin123`

## 模块编译顺序

Maven会自动处理模块依赖顺序，但了解顺序有助于理解项目结构：

```
1. nhk-common    (通用模块，无依赖)
2. nhk-model     (依赖 nhk-common)
3. nhk-service   (依赖 nhk-model)
4. nhk-api       (依赖 nhk-service)
5. nhk-start     (依赖 nhk-api)
```

## 常见问题

### 问题1：端口被占用
**错误**: `Address already in use: bind`

**解决**:
```bash
# 查找占用8080端口的进程
lsof -i :8080

# 杀死进程
kill -9 <PID>
```

### 问题2：数据库连接失败
**错误**: `Communications link failure`

**检查**:
1. MySQL服务是否启动
2. 用户名密码是否正确
3. 数据库newhker是否已创建

### 问题3：Redis连接失败
**错误**: `Unable to connect to Redis`

**检查**:
```bash
# 测试Redis连接
redis-cli ping
# 应该返回 PONG
```

### 问题4：Maven编译失败
**错误**: `Failed to execute goal`

**解决**:
```bash
# 清理并重新编译
cd backend
mvn clean install -U
```

### 问题5：找不到某个类
**错误**: `Cannot find symbol`

**解决**:
```bash
# 确保所有依赖模块已安装
cd backend
mvn clean install -DskipTests
```

## 开发模式

### 热部署（可选）

在 `nhk-start/pom.xml` 中已配置 `spring-boot-devtools`（如需要可添加）:
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <optional>true</optional>
</dependency>
```

### 调试模式

```bash
# Maven调试运行
cd backend/nhk-start
mvn spring-boot:run -Dspring-boot.run.jvmArguments="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"
```

然后在IDE中配置远程调试，连接到端口5005。

## 日志查看

后端日志会输出到控制台，也可以配置文件日志：

在 `application.yml` 中添加：
```yaml
logging:
  file:
    name: logs/newhker.log
  pattern:
    file: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n'
```

## 停止服务

### 停止后端
- 如果是Maven运行：`Ctrl + C`
- 如果是jar运行：`Ctrl + C` 或 `kill <PID>`

### 停止前端
- 在终端按 `Ctrl + C`

## 下一步

- 查看 `模块化改造说明.md` 了解项目结构
- 查看 `项目说明.md` 了解详细功能
- 开始开发新功能！
